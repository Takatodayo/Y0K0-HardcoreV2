<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - ãƒãƒ¼ãƒ‰ã‚³ã‚¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #2c003e 0%, #5a0080 100%);
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 40px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .admin-info {
            text-align: right;
            margin-bottom: 20px;
            color: #b19cd9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .dashboard-card {
            background-color: #2a2a2a;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border: 2px solid #444;
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(90, 0, 128, 0.3);
            border-color: #5a0080;
        }

        .card-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
            text-align: center;
        }

        .card-title {
            font-size: 1.5em;
            color: #b19cd9;
            margin-bottom: 15px;
            text-align: center;
        }

        .card-description {
            margin-bottom: 20px;
            color: #ccc;
            text-align: center;
        }

        .card-button {
            display: block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #5a0080 0%, #7a00b0 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .card-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(90, 0, 128, 0.4);
        }

        .danger-button {
            background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
        }

        .danger-button:hover {
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.4);
        }

        .history-section {
            background-color: #2a2a2a;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .history-title {
            color: #b19cd9;
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #444;
        }

        .history-table th {
            background-color: #5a0080;
            color: white;
        }

        .history-table tr:hover {
            background-color: #333;
        }

        .logout-button {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #666;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .logout-button:hover {
            background-color: #888;
        }

        .footer {
            text-align: center;
            margin-top: 60px;
            padding: 20px;
            color: #666;
        }

        /* ã‚¢ãƒ©ãƒ¼ãƒˆãƒœãƒƒã‚¯ã‚¹ */
        .alert {
            background-color: #4a0000;
            border: 2px solid #ff0000;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .alert-title {
            color: #ff6666;
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <script src="js/auth-check.js"></script>
    
    <div class="container">
        <div class="admin-info">
            ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ | ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™: <span id="sessionTimer"></span>
        </div>
        
        <a href="#" class="logout-button" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
        
        <header>
            <h1>ğŸ”§ ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ ğŸ”§</h1>
            <p style="margin-top: 10px; color: #b19cd9;">ãƒãƒ¼ãƒ‰ã‚³ã‚¢ä¼ç”»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
        </header>
        
        <div class="alert">
            <div class="alert-title">âš ï¸ é‡è¦ãªæ³¨æ„äº‹é … âš ï¸</div>
            <p>ã“ã®ãƒšãƒ¼ã‚¸ã¯ç®¡ç†è€…å°‚ç”¨ã§ã™ã€‚å‚åŠ è€…ã«ã¯çµ¶å¯¾ã«è¦‹ã›ãªã„ã§ãã ã•ã„ã€‚</p>
        </div>
        
        <div class="dashboard-grid">
            <!-- ãƒã‚¤ãƒ³ãƒˆè¨ˆç®— -->
            <div class="dashboard-card">
                <span class="card-icon">ğŸ§®</span>
                <h2 class="card-title">ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—</h2>
                <p class="card-description">
                    æ­»å› ã‚«ã‚¦ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãƒã‚¤ãƒ³ãƒˆã‚’è¨ˆç®—ãƒ»ä¿å­˜ã—ã¾ã™ã€‚
                    æ–°æ—§ä¸¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å¯¾å¿œã€‚
                </p>
                <a href="point-calculator.html" class="card-button">è¨ˆç®—ç”»é¢ã‚’é–‹ã</a>
            </div>
            
            <!-- ç½°ã‚²ãƒ¼ãƒ å…¥åŠ› -->
            <div class="dashboard-card">
                <span class="card-icon">ğŸ“</span>
                <h2 class="card-title">ç½°ã‚²ãƒ¼ãƒ è¨­å®š</h2>
                <p class="card-description">
                    ç½°ã‚²ãƒ¼ãƒ å¯¾è±¡è€…ã¨ç½°ã‚²ãƒ¼ãƒ å†…å®¹ã‚’è¨­å®šã—ã¾ã™ã€‚
                    ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰è‡ªå‹•é¸æŠå¯èƒ½ã€‚
                </p>
                <a href="penalty-input.html" class="card-button">è¨­å®šç”»é¢ã‚’é–‹ã</a>
            </div>
            
            <!-- é€”ä¸­é›¢è„±ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ -->
            <div class="dashboard-card">
                <span class="card-icon">ğŸ°</span>
                <h2 class="card-title">é›¢è„±ãƒšãƒŠãƒ«ãƒ†ã‚£ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h2>
                <p class="card-description">
                    é€”ä¸­é›¢è„±è€…ç”¨ã®ãƒšãƒŠãƒ«ãƒ†ã‚£ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã€‚
                    0ã€œ100ãƒã‚¤ãƒ³ãƒˆãŒãƒ©ãƒ³ãƒ€ãƒ ã«åŠ ç®—ã•ã‚Œã¾ã™ã€‚
                </p>
                <a href="penalty-roulette.html" class="card-button danger-button">ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚’é–‹ã</a>
            </div>
            
            <!-- ä¼ç”»ãƒ«ãƒ¼ãƒ«ç¢ºèª -->
            <div class="dashboard-card">
                <span class="card-icon">ğŸ“–</span>
                <h2 class="card-title">ä¼ç”»ãƒ«ãƒ¼ãƒ«ç¢ºèª</h2>
                <p class="card-description">
                    å‚åŠ è€…å‘ã‘ã®ãƒ«ãƒ¼ãƒ«èª¬æ˜ãƒšãƒ¼ã‚¸ã‚’ç¢ºèªã§ãã¾ã™ã€‚
                    äº‹å‰ãƒã‚§ãƒƒã‚¯ç”¨ã€‚
                </p>
                <a href="index.html" class="card-button">ãƒ«ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã¸</a>
            </div>
        </div>
        
        <!-- é›¢è„±å±¥æ­´ -->
        <div class="history-section">
            <h2 class="history-title">ğŸ“Š é›¢è„±ãƒšãƒŠãƒ«ãƒ†ã‚£å±¥æ­´</h2>
            <table class="history-table" id="penaltyHistory">
                <thead>
                    <tr>
                        <th>æ™‚åˆ»</th>
                        <th>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</th>
                        <th>ãƒšãƒŠãƒ«ãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆ</th>
                    </tr>
                </thead>
                <tbody id="historyBody">
                    <!-- å±¥æ­´ãŒå‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ -->
                </tbody>
            </table>
            <p style="margin-top: 20px; text-align: center;">
                <button onclick="clearHistory()" style="padding: 10px 20px; background-color: #ff0000; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    å±¥æ­´ã‚’ã‚¯ãƒªã‚¢
                </button>
                <button onclick="exportData()" style="padding: 10px 20px; background-color: #5a0080; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                    ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                </button>
            </p>
        </div>
        
        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±è¨ˆ -->
        <div class="history-section">
            <h2 class="history-title">ğŸ“ˆ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±è¨ˆ</h2>
            <table class="history-table" id="playerStats">
                <thead>
                    <tr>
                        <th>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</th>
                        <th>ç·æ­»äº¡æ•°</th>
                        <th>æ­»å› ãƒã‚¤ãƒ³ãƒˆ</th>
                        <th>é›¢è„±ãƒšãƒŠãƒ«ãƒ†ã‚£</th>
                        <th>ç·ãƒã‚¤ãƒ³ãƒˆ</th>
                    </tr>
                </thead>
                <tbody id="statsBody">
                    <!-- çµ±è¨ˆãŒå‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ -->
                </tbody>
            </table>
            <p style="margin-top: 20px; text-align: center;">
                <button onclick="clearPlayerStats()" style="padding: 10px 20px; background-color: #ff0000; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆ
                </button>
                <button onclick="clearSpecificPlayer()" style="padding: 10px 20px; background-color: #ff6600; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                    ç‰¹å®šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
                </button>
            </p>
        </div>
        
        <div class="footer">
            <p>Hardcore Admin System v1.0</p>
            <p style="margin-top: 10px;">
                <a href="index.html" style="color: #666; text-decoration: none;">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸</a>
            </p>
        </div>
    </div>
    
    <script src="js/database.js"></script>
    <script>
        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
        function updateSessionTimer() {
            const authTime = parseInt(sessionStorage.getItem('authTime'));
            const remaining = 3600000 - (Date.now() - authTime);
            
            if (remaining <= 0) {
                logout();
                return;
            }
            
            const minutes = Math.floor(remaining / 60000);
            const seconds = Math.floor((remaining % 60000) / 1000);
            document.getElementById('sessionTimer').textContent = `${minutes}åˆ†${seconds}ç§’`;
        }
        
        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        function logout() {
            sessionStorage.removeItem('adminAuthenticated');
            sessionStorage.removeItem('authTime');
            window.location.href = 'admin-login.html';
        }
        
        // é›¢è„±å±¥æ­´ã‚’è¡¨ç¤º
        async function loadHistory() {
            try {
                const history = await hardcoreDB.getPenaltyHistory();
                const tbody = document.getElementById('historyBody');
                
                tbody.innerHTML = '';
                
                if (history.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #666;">å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                    return;
                }
                
                // æ–°ã—ã„é †ã«ã‚½ãƒ¼ãƒˆ
                history.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                history.forEach(item => {
                    const row = document.createElement('tr');
                    const date = new Date(item.timestamp);
                    row.innerHTML = `
                        <td>${date.toLocaleString('ja-JP')}</td>
                        <td>${item.playerName}</td>
                        <td style="color: ${item.points === 0 ? '#44ff44' : '#ff6666'};">${item.points}pt</td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Failed to load history:', error);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: localStorageã‹ã‚‰èª­ã¿è¾¼ã¿
                const history = JSON.parse(localStorage.getItem('penaltyHistory') || '[]');
                const tbody = document.getElementById('historyBody');
                
                tbody.innerHTML = '';
                
                if (history.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #666;">å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                    return;
                }
                
                history.reverse().forEach(item => {
                    const row = document.createElement('tr');
                    const date = new Date(item.timestamp);
                    row.innerHTML = `
                        <td>${date.toLocaleString('ja-JP')}</td>
                        <td>${item.player}</td>
                        <td style="color: ${item.points === 0 ? '#44ff44' : '#ff6666'};">${item.points}pt</td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }
        
        // å±¥æ­´ã‚¯ãƒªã‚¢
        async function clearHistory() {
            if (confirm('æœ¬å½“ã«å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                try {
                    await hardcoreDB.clearAllData();
                    console.log('Database cleared');
                } catch (error) {
                    console.error('Failed to clear database:', error);
                }
                localStorage.removeItem('penaltyHistory');
                loadHistory();
                loadPlayerStats();
            }
        }
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆ
        async function clearPlayerStats() {
            if (confirm('æœ¬å½“ã«å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nâ€»æ­»å› è¨˜éŒ²ã‚„å±¥æ­´ã¯ä¿æŒã•ã‚Œã¾ã™')) {
                try {
                    await hardcoreDB.clearPlayerStats();
                    alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
                    loadPlayerStats();
                } catch (error) {
                    console.error('Failed to clear player stats:', error);
                    alert('ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
        }
        
        // ç‰¹å®šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
        async function clearSpecificPlayer() {
            const playerName = prompt('ãƒªã‚»ãƒƒãƒˆã™ã‚‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
            if (!playerName) return;
            
            if (confirm(`${playerName}ã•ã‚“ã®çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ`)) {
                try {
                    await hardcoreDB.clearPlayerStat(playerName);
                    alert(`${playerName}ã•ã‚“ã®çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ`);
                    loadPlayerStats();
                } catch (error) {
                    console.error('Failed to clear specific player:', error);
                    alert('ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
        }
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±è¨ˆã‚’è¡¨ç¤º
        async function loadPlayerStats() {
            try {
                const stats = await hardcoreDB.getAllPlayerStats();
                const tbody = document.getElementById('statsBody');
                
                tbody.innerHTML = '';
                
                if (stats.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666;">çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                    return;
                }
                
                // ç·ãƒã‚¤ãƒ³ãƒˆé †ã«ã‚½ãƒ¼ãƒˆ
                stats.sort((a, b) => b.totalPoints - a.totalPoints);
                
                stats.forEach(player => {
                    const row = document.createElement('tr');
                    const deathPoints = player.totalPoints - (player.penaltyPoints || 0);
                    row.innerHTML = `
                        <td>${player.playerName}</td>
                        <td>${player.totalDeaths || 0}</td>
                        <td>${deathPoints}pt</td>
                        <td>${player.penaltyPoints || 0}pt</td>
                        <td style="color: #ffd700; font-weight: bold;">${player.totalPoints}pt</td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Failed to load player stats:', error);
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        async function exportData() {
            try {
                const data = await hardcoreDB.exportData();
                const jsonStr = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `hardcore_data_${new Date().toISOString().replace(/:/g, '-')}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Failed to export data:', error);
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        // åˆæœŸåŒ–
        async function init() {
            try {
                await hardcoreDB.init();
                console.log('Database initialized');
            } catch (error) {
                console.error('Failed to initialize database:', error);
            }
            setInterval(updateSessionTimer, 1000);
            loadHistory();
            loadPlayerStats();
        }
        
        init();
    </script>
</body>
</html>